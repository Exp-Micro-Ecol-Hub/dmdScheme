---
params:
  author: unknown
  title: Validation
  x: NULL
  result: NULL
title: "`r params$title`"
author: "`r params$author`"
date: "`r Sys.Date()`"
output:
  html_document: 
    toc_depth: 3
    toc: true
    toc_float: true
  pdf_document: default
  word_document: default
---


```{r setup, include=FALSE}
library(magrittr)
library(knitr)
knitr::opts_chunk$set(echo = TRUE)
x <- params$x
result <- params$result

## only for debugging ##
if (is.null(x)) {
  if (!require("emeScheme")) {
    devtools::load_all()
  }
  x <- emeScheme::emeScheme_raw
  result <- validate(x = emeScheme_raw, validateData = TRUE, report = "none")
}
## ##
## Define colours for results of evaluation

```

* **Author**: `r params$author`
* **emeScheme metadata name**: `r attr(x, "fileName")`
* **data package path**: `add this`

<!-- ################################### -->
<!-- ################################### -->
<!-- Overview -->
<!-- ################################### -->
<!-- ################################### -->

# Overview

<!-- ################################### -->
<!-- Structural -->
<!-- ################################### -->

## `r valErr_TextErrCol("Structural / Formal validity", result$structure$error)`

## `r valErr_TextErrCol("Experiment", result$Experiment$error)`
- `r valErr_TextErrCol("conversion of values into specified type lossless possible", result$Experiment$types$error)` [See Details](#ExperimentTypes)
- `r valErr_TextErrCol("values in suggestedValues", result$Experiment$suggestedValues$error)` [See Details](#ExperimentSuggested)

<!-- ################################### -->
<!-- Species -->
<!-- ################################### -->

## `r valErr_TextErrCol("Species", result$Species$error)`

- `r valErr_TextErrCol("conversion of values into specified type lossless possible", result$Species$types$error)` [See Details](#SpeciesTypes)
- `r valErr_TextErrCol("values in suggestedValues", result$Species$suggestedValues$error)` [See Details](#SpeciesSuggested)
- `r valErr_TextErrCol("name in species database and report score (using taxize::gnr_resolve())", result$Species$suggestedValues$error)` [See Details](#SpeciesNames)

<!-- ################################### -->
<!-- Treatment -->
<!-- ################################### -->

## `r valErr_TextErrCol("Treatment", result$Treatment$error)`
- `r valErr_TextErrCol("conversion of values into specified type lossless possible", result$Treatment$types$error)` [See Details](#TreatmentTypes)
- `r valErr_TextErrCol("values in suggestedValues", result$Treatment$suggestedValues$error)` [See Details](#TreatmentSuggested)

### <== DataFileMetaData
- `r valErr_TextErrCol("parameter is in mappingColumn", result$Treatment$parameterInMappinColumn$error)` [see Details](#TreatmentParameter)

<!-- ################################### -->
<!-- Measurement -->
<!-- ################################### -->

## `r valErr_TextErrCol("Measurement", result$Measurement$error)`
- `r valErr_TextErrCol("conversion of values into specified type lossless possible", result$Measurement$types$error)` [See Details](#MeasurementTypes)
- `r valErr_TextErrCol("values in suggestedValues", result$Measurement$suggestedValues$error)` [See Details](#MeasurementSuggested)
- `r valErr_TextErrCol("names unique", result$Measurement$nameUnique$error)` [details](#MeasurementNameUnique)
- `r valErr_TextErrCol("measuredFrom is 'raw', 'NA', NA or in name", result$Measurement$measuredFrom$error)` [details](#MeasurementFrom)

### <== DataFileMetaData
- `r valErr_TextErrCol("variable is in mappingColumn", result$Measurement$variableInMappinColumn$error)`

### <== DataExtractionName
- `r valErr_TextErrCol("dataExtractionName is 'none', 'NA', NA, or in DataExtraction$name", result$Measurement$dataExtractionNameInDataExtractionName$error)`

<!-- ################################### -->
<!-- DataExtraction -->
<!-- ################################### -->

## `r valErr_TextErrCol("DataExtraction", result$DataExtraction$error)`
- `r valErr_TextErrCol("conversion of values into specified type lossless possible", result$DataExtraction$types$error)` [See Details](#DataExtractionTypes)
- `r valErr_TextErrCol("values in suggestedValues", result$DataExtraction$suggestedValues$error)` [See Details](#DataExtractionSuggested)
- `r valErr_TextErrCol("names unique", result$DataExtraction$nameUnique$error)` [See Details](#DataExtractionNameUnique})

### <== Measurement
- `r valErr_TextErrCol("name is in Measurement$dataExtractionName", result$DataExtraction$nameInDataExtractionName$error)` [See Details](#DataExtractionNameName})

<!-- ################################### -->
<!-- DataFileMetaData -->
<!-- ################################### -->

## `r valErr_TextErrCol("DataFileMetaData", result$DataFileMetaData$error)`
- `r valErr_TextErrCol("conversion of values into specified type lossless possible", result$DataFileMetaData$types$error)` (#DataFileMetaDataTypes)
- `r valErr_TextErrCol("values in allowedValues", result$DataFileMetaData$allowedValues$error)` (#DataFileMetaDataAllowed)
- `r valErr_TextErrCol("dataFile exists in path", result$DataFileMetaData$dataFilesExist$error)`
- `r valErr_TextErrCol("if type == 'datetime', description has format information", result$DataFileMetaData$datetimeFormatSpecified$error)`

## <== Measurement & Treatment
- `r valErr_TextErrCol("correct values in mappingColumn in dependence on columnData", result$DataFileMetaData$mappingColumnInNameOrParameter$error)` [See details](location)

### <== data file
- [ ] `columnName` has to be in the data file `dataFileName`
- [ ] the date, time and date time can be converted using the format specifications in `description`

<!-- ################################### -->
<!-- Data Files -->
<!-- ################################### -->

## Data Files
- [ ] ranges of numeric columns
- [ ] values of text columns
- [ ] ???

### <== DataFileMetaData
- [ ] column names have to be in `DataFileName$columnName`

### <== Treatment
- [ ] the **values** in the column describing the treatment (i.e. treatment levels) have to be in the column `Treatment$treatmentLevel` of the corresponding `Treatment$parameter`

### <== Measurement
- [ ] type checks of `columnName` compared to `type`

# Other Validity Checks
- [ ] ???


<!-- ################################### -->
<!-- ################################### -->
<!-- Details -->
<!-- ################################### -->
<!-- ################################### -->


# Details


## Overall validation outcome

Here there will be a report on the overall validation outcome, e.g., your metadata-data combination passed x/y critical tests, and passed z/n desirable tests. Please see below for details of each test result.


Put this in an appendix.
```{r info}
attributes(x)
```

Use conditional text to explicitly say pass or fail, so that users don't have to read the R output (or at least get lovely green text for pass, and red for fail!)

## Validate General Structure
```{r val_struct, options}
result$structOK
```


## Validate Experiment
### Types {#ExperimentTypes}
```{r}
result$Experiment$types$details %>%
  kable()
```

### Suggested Values {#ExperimentSuggested}
```{r}
result$Experiment$suggestedValues$details %>%
  kable()
```

## Validate Species 
### Types {#SpeciesTypes}
```{r}
result$Species$types$details %>%
  kable()
```

### Suggested Values {#SpeciesSuggested}
```{r}
result$Species$suggestedValues$details %>%
  kable()
```

### Species Names {#SpeciesNames}
```{r}
result$Species$speciesNames$details %>%
  kable()
```

## Validate Treatment
### Types {#TreatmentTypes}
```{r}
result$Treatment$types$details %>%
  kable()
```

### Suggested Values {#TreatmentSuggested}
```{r}
result$Treatment$suggestedValues$details %>%
  kable()
```

### Suggested Values {#TreatmentParameter}
```{r}
result$Treatment$parameterInMappinColumn$details %>%
  kable()
```

## Validate Measurement
### Types {#MeasurementTypes}
```{r}
result$Measurement$types$details %>%
  kable()
```

### suggested values {#MeasurementSuggested}
 ```{r}
result$Measurement$suggestedValue$detailss %>%
  kable()
```

### name unique {#MeasurementNameUnique}
```{r}
 result$Measurement$nameUnique$details %>%
  kable()
```

### measuredFrom is 'raw', 'NA' or NA {#MeasurementFrom}
```{r}
result$Measurement$measuredFrom$details %>%
  kable()
```



 
## Validate DataExtraction
### Types {#DataExtractionTypes}
```{r}
result$DataExtraction$types$details %>%
  kable()
```

### Suggested Values {#DataExtractionSuggested}
```{r} 
result$DataExtraction$suggestedValues$details %>%
  kable()
```

### name unique {#DataExtractionNameUnique}
```{r} 
cat_ln("CHECK - TODO")
# result$DataExtraction$nameUnique$details %>%
#  kable()
```

### name in DataExtraction$name {#DataExtractionNameName}
```{r} 
cat_ln("CHECK - TODO")
# result$DataExtraction$nameInDataExtractionName$details %>%
#   kable()
```

## Validate DataFileMetaData
### Types {#DataFileMetadataFilesTypes}
```{r}
result$DataFileMetaData$types$details %>%
  kable()
```

### Suggested Values {#DataFileMetadataAllowed}
```{r}
result$DataFileMetaData$allowedValues$details %>%
  kable()
```

### Validate mappingColumn

### Validation out of attempt to parse date variables

## To do

