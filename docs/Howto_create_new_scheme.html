<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Howto Create a new scheme</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Howto Create a new scheme</h1>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This package in itself is of not much use, as it only contains an example scheme. But it contains all the functionality to easily create a new scheme in an R package, which includes all the folowing functionality automatically:</p>
<ol style="list-style-type: decimal">
<li>enter metadata into an included spreadsheet based on the initial definition (<code>enter_new_metadata()</code>);</li>
<li>import metadata entered in a spreadsheet into R and having it in an interoperable format available (<code>read_fron_excel()</code>);</li>
<li>validate the entered metadata against the defined scheme, including rules concerning type of data (e.g. character, numeric, integer, …), suggested values and allowed values and general structure (<code>validate()</code>);</li>
<li>create a report in <code>.html</code>, <code>.pdf</code> or <code>.docx</code> formnat containing the results of the validation (<code>validate_report()</code>);</li>
<li>export the metadata to xml format to make it accessible to data repositories (<code>dmdSchemeToXml()</code>);</li>
<li>import an exported xml again for reuse (<code>xmlToDmdScheme()</code>)</li>
</ol>
<p>This functionality is contained in an R package, which can be distributed for usage and metadata entering.</p>
</div>
<div id="how-to-create-a-package-with-an-own-scheme" class="section level1">
<h1>How to create a package with an own scheme</h1>
<p>The steps do create such a package are discussed below in detail</p>
<div id="install-the-package-dmdscheme" class="section level2">
<h2>Install the package <code>dmdScheme</code></h2>
<p>In most cases, when you read this, you already have installed the package <code>dmdScheme</code>. If not there are three ways to install it:</p>
<ol style="list-style-type: decimal">
<li>via CRAN This will install the last stable version. It is momentarily not possible, as the package is not yet released on CRAN.</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">install.packages</span>(<span class="st">&quot;dmdScheme&quot;</span>)</a></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>via <code>drat</code> This will iknstall the last released development version. <code>drat</code> is a too to run an own CRAN like repository. This drat repository contains the dev versions of the package. These are likely stable, but are not as tested as the ones on CRAN. see <a href="http://dirk.eddelbuettel.com/code/drat.html">the drat vignette</a> for further info. You need to install <code>drat</code> to use this:</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">install.packages</span>(<span class="st">&quot;drat&quot;</span>)</a>
<a class="sourceLine" id="cb2-2" title="2">drat<span class="op">::</span><span class="kw">addRepo</span>(<span class="st">&quot;rkrug&quot;</span>)</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">install.packages</span>(<span class="st">&quot;dmdScheme&quot;</span>)</a></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>via github This will install the last development version. The development of this package is hosted on <a href="https://github.com/rkrug/dmdScheme">github</a>. You can also install from there. This will give you the most recent version in development. You can also choose different branches to install. Please see the documentation of the <a href="https://github.com/r-lib/remotes">remotes package</a> for details.</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">install.packages</span>(<span class="st">&quot;remotes&quot;</span>)</a>
<a class="sourceLine" id="cb3-2" title="2">remotes<span class="op">::</span><span class="kw">install.packages</span>(<span class="st">&quot;rkrug/dmdScheme&quot;</span>)</a></code></pre></div>
<p>For general uasage, we recommend to use these CRAN for production usage. If you want to try the newst features, use the drat version, and only if you want to live at the bleeding edge, and can live with crashes and untested exciting new features, use the github version.</p>
</div>
<div id="create-a-template-for-the-new-scheme" class="section level2">
<h2>Create a template for the new scheme</h2>
<p>Creating a template is as easy as running the following two commands. For simlicity, we use a scheme definition as inclusded in the package as an example:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">library</span>(dmdScheme)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">make_new_scheme</span>(<span class="dt">schemeDefinition =</span> <span class="kw">system.file</span>(<span class="st">&quot;newSchemeDefinition.xlsx&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;dmdScheme&quot;</span>) , <span class="dt">path =</span> <span class="st">&quot;our_new_scheme&quot;</span>)</a></code></pre></div>
<p>This will create a directory named <code>our_new_scheme</code> in the current directory and use the <code>schemeDefinition</code> excel file to create a new package containing the scheme definition.</p>
<p>If you open the scheme definition, you will see in the <code>Experiment</code> tab one cell containing the value <strong>DATA exampleScheme v1.2.3</strong>. <strong>exampleScheme</strong> will become the <code>schemeName</code> and the name of the new package, and <strong>1.2.3</strong> the <code>schemeVersion</code>. The <code>Version</code> of the new package will be set to 1.0.</p>
<p>Now you have the source code for a functional R package, which you can use to enter metadata into the new scheme (<code>enter_new_metadata(schemeName = &quot;exampleScheme&quot;)</code>) and do all the other things as explained in the howto manual <a href="TODO">TODO</a>.</p>
</div>
</div>
<div id="extending-the-functionality-of-the-dmdscheme-package" class="section level1">
<h1>Extending the functionality of the dmdScheme package</h1>
<p>s the functionality of the <code>dmdScheme</code> package is irrespective of the structure of the metadata scheme (see the vignette <strong>Minimum requirements for metadatascheme based on dmdScheme</strong> for the minimum requirements), it’s functionality is limited. But it is easy to extend this functionality.</p>
<div id="validation" class="section level2">
<h2>Validation</h2>
<p>A detailed validations in respect to the scheme itself are not implemented. This means, that the validation only verifies</p>
<ol style="list-style-type: decimal">
<li>that the values are of the required types (if not ==&gt; error)</li>
<li>are in the allowedValues (if not ==&gt; error)</li>
<li>are in the suggestedValues (if not ==&gt; note)</li>
</ol>
<p>As the <code>validation()</code> function is implemented as a generic function, all which needs to be done is create a generic function for the new scheme (in our example <code>exampleSchemeSet_raw</code>), which should have the following structure:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">validate.emeSchemeSet_raw &lt;-<span class="st"> </span><span class="cf">function</span>(</a>
<a class="sourceLine" id="cb5-2" title="2">  x,</a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="dt">path =</span> <span class="st">&quot;.&quot;</span>,</a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="dt">validateData =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="dt">report =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb5-6" title="6">  <span class="dt">report_author =</span> <span class="st">&quot;Tester&quot;</span>,</a>
<a class="sourceLine" id="cb5-7" title="7">  <span class="dt">report_title =</span> <span class="st">&quot;Validation of data against emeScheme&quot;</span>,</a>
<a class="sourceLine" id="cb5-8" title="8">  <span class="dt">errorIfStructFalse =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb5-9" title="9">) {</a>
<a class="sourceLine" id="cb5-10" title="10">  result &lt;-<span class="st"> </span><span class="kw">new_emeScheme_validation</span>()</a>
<a class="sourceLine" id="cb5-11" title="11">  <span class="co">## do the validations</span></a>
<a class="sourceLine" id="cb5-12" title="12">  <span class="kw">return</span>(result)</a>
<a class="sourceLine" id="cb5-13" title="13">}</a></code></pre></div>
<p>For an extensive example of this see the R folder in the <a href="https://github.com/Exp-Micro-Ecol-Hub/emeScheme">emeScheme package on github</a>.</p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
